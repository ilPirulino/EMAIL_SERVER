<html>
<head>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
</head>
<body>
    <form>
        <button type="button" onclick="Save_and_Send()">Save and Send</button>
    </form>
    <py-script>
        import ssl
        import smtplib
        from email import encoders
        from email.mime.multipart import MIMEMultipart
        from email.mime.text import MIMEText
        from email.mime.base import MIMEBase
        from flask import Flask

        #credenziali d'accesso
        email_sender = 'alebig2006@gmail.com'
        email_password = 'ofhy qcsc xznf sdvo' #password esclusiva per le email inviate con python
        filepath = "C:\\Users\\Alessio\\PycharmProjects\\SMTPLIB_Try01\\.venv\\Report_prova02.5.pdf"

        #email ricevitore
        email_receiver = email_sender

        #struttura effettiva dell'email
        subject = "Prova invio email 01"
        body = """
        Prova avvenuta con successo!

        """

        def Send_Email(fromadd, password, toadd, subject, body, file):

            link = "https://github.com/BigonAlessio/PCTO_Return_Email/blob/main/Return.html"
            #https://github.com/BigonAlessio/PCTO_Return_Email.git
            msg = MIMEMultipart('alternative')
            msg['Subject'] = subject
            msg['From'] = fromadd
            msg['To'] = toadd
            part1 = MIMEText(body, 'plain')
            part2 = MIMEText(link, 'html')
            msg.attach(part1)
            msg.attach(part2)

            # apertura file pdf da inoltrare
            attachment = MIMEBase('application', 'octet-stream')
            with open(file, 'rb') as cargo:
                attachment.set_payload(cargo.read())
            encoders.encode_base64(attachment)
            attachment.add_header('Content-Disposition', 'attachment', filename=file[-20:])
            msg.attach(attachment)

            # creazione del messaggio
            context = ssl.create_default_context()
            print(">>Compilation of the message")

            # try per stabilire un collegamento e inviare la mail
            try:
                with smtplib.SMTP_SSL('smtp.gmail.com', 465, context=context) as smtp:  # utilizzo del protocollo SSL
                    print('>>Creation of the connection')
                    smtp.login(fromadd, password)  # login alla mail
                    print(">>Login")
                    smtp.sendmail(fromadd, toadd, msg.as_string())  # invio della mail
                    print(">>Email sent")
            except Exception as e:
                print(f">>Mission Failed-: {e}")

            Send_Email(email_sender, email_password, email_receiver, subject, body, filepath)
    </py-script>
    <script>
        function Save_and_Send(){
            var email_sender = document.getElementById(email_sender)
            var email_password = document.getElementById(email_password)
            var email_receiver = document.getElementById(email_receiver)
            var subject = document.getElementById(subject)
            var body = document.getElementById(body)
            var file = document.getElementById(file)

        }
    </script>
</body>
</html>


